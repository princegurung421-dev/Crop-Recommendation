<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart Crop Recommendation AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-leaf me-2"></i>Smart Crop Recommendation
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/how-it-works">How it Works</a></li>
                    <li class="nav-item"><a class="nav-link" href="/documentation">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="margin-top: 100px;">
        <div class="hero-section animate-fade-in">
            <h1 class="hero-title">Smart Farming, Better Yields</h1>
            <p class="hero-subtitle">Use our advanced AI model to determine the best crop for your soil conditions.</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card main-card animate-fade-in">
                    <form id="prediction-form">
                        <div class="row g-4">
                            <!-- Soil Nutrients -->
                            <div class="col-md-4">
                                <label for="Nitrogen" class="form-label"><i
                                        class="fas fa-flask me-2 text-success"></i>Nitrogen (N)</label>
                                <input type="number" step="0.01" class="form-control" id="Nitrogen" name="Nitrogen"
                                    placeholder="e.g. 90" required>
                            </div>
                            <div class="col-md-4">
                                <label for="Phosporus" class="form-label"><i
                                        class="fas fa-flask me-2 text-info"></i>Phosphorus (P)</label>
                                <input type="number" step="0.01" class="form-control" id="Phosporus" name="Phosporus"
                                    placeholder="e.g. 42" required>
                            </div>
                            <div class="col-md-4">
                                <label for="Potassium" class="form-label"><i
                                        class="fas fa-flask me-2 text-danger"></i>Potassium (K)</label>
                                <input type="number" step="0.01" class="form-control" id="Potassium" name="Potassium"
                                    placeholder="e.g. 43" required>
                            </div>

                            <!-- Environmental Factors -->
                            <div class="col-md-6">
                                <label for="Temperature" class="form-label"><i
                                        class="fas fa-temperature-high me-2 text-warning"></i>Temperature (Â°C)</label>
                                <input type="number" step="0.01" class="form-control" id="Temperature"
                                    name="Temperature" placeholder="e.g. 20.8" required>
                            </div>
                            <div class="col-md-6">
                                <label for="Humidity" class="form-label"><i
                                        class="fas fa-tint me-2 text-primary"></i>Humidity (%)</label>
                                <input type="number" step="0.01" class="form-control" id="Humidity" name="Humidity"
                                    placeholder="e.g. 82.0" required>
                            </div>

                            <!-- Other Metrics -->
                            <div class="col-md-6">
                                <label for="Ph" class="form-label"><i class="fas fa-vial me-2 text-secondary"></i>pH
                                    Level</label>
                                <input type="number" step="0.01" class="form-control" id="Ph" name="Ph"
                                    placeholder="e.g. 6.5" required>
                            </div>
                            <div class="col-md-6">
                                <label for="Rainfall" class="form-label"><i
                                        class="fas fa-cloud-rain me-2 text-dark"></i>Rainfall (mm)</label>
                                <input type="number" step="0.01" class="form-control" id="Rainfall" name="Rainfall"
                                    placeholder="e.g. 202.9" required>
                            </div>
                        </div>

                        <div class="text-center mt-5">
                            <button type="submit" class="btn btn-predict">
                                <i class="fas fa-search me-2"></i>Recommend Crop
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Result Section (Hidden by default) -->
        <div class="row justify-content-center mb-5 animate-fade-in" id="result-section" style="display: none;">
            <div class="col-md-6">
                <div class="result-card text-center">
                    <img id="result-image" src="" alt="Farming" class="img-fluid">

                    <div class="result-body">
                        <p class="result-title">Optimized Crop Choice</p>
                        <h2 class="result-crop" id="result-crop-name"></h2>
                        <p class="mt-2" id="result-text"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('prediction-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;

            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.result) {
                    // Update Content
                    document.getElementById('result-crop-name').innerText = data.crop || "Unknown";
                    document.getElementById('result-text').innerText = data.result;

                    // Dynamic Image Loading
                    const imgElement = document.getElementById('result-image');
                    // Ensure the base path ends with a slash
                    const basePath = "{{ url_for('static', filename='images/crops/') }}";
                    const imagePath = basePath + data.image_name;
                    const fallbackPath = "{{ url_for('static', filename='images/img.jpg') }}";

                    imgElement.src = imagePath;
                    imgElement.onerror = function () {
                        this.src = fallbackPath;
                    };

                    // Show Result
                    const resultSection = document.getElementById('result-section');
                    resultSection.style.display = 'block'; // Or 'flex' if needed
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                } else if (data.error) {
                    alert("Error: " + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert("An error occurred while processing your request.");
            } finally {
                // Reset button
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>

</html>